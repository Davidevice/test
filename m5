#include "WiFi.h"
 #include "Adafruit_MQTT.h"
#include "Adafruit_MQTT_Client.h"
const char* ssid = "ASUS";
const char* password =  "2325051316";
#include <M5StickC.h> 
 #define AIO_SERVER      "mqtt.gbridge.io"
#define AIO_SERVERPORT  1883                   // use 8883 for SSL
#define AIO_USERNAME    "gbridge-u726"
#define AIO_KEY         "2325051316"  
#define button 37
const char MQTT_SERVER[] PROGMEM    = AIO_SERVER;
const char MQTT_USERNAME[] PROGMEM  = AIO_USERNAME;
const char MQTT_PASSWORD[] PROGMEM  = AIO_KEY;

 WiFiClient client;

Adafruit_MQTT_Client mqtt(&client, AIO_SERVER, AIO_SERVERPORT, AIO_USERNAME, AIO_KEY);

Adafruit_MQTT_Subscribe luminosita = Adafruit_MQTT_Subscribe(&mqtt, "gBridge/u726/d2334/brightness");
Adafruit_MQTT_Subscribe onoff = Adafruit_MQTT_Subscribe(&mqtt, "gBridge/u726/d2334/onoff");

Adafruit_MQTT_Publish SETluminosita = Adafruit_MQTT_Publish(&mqtt, "gBridge/u726/d2334/brightness/set");
Adafruit_MQTT_Publish SETonoff = Adafruit_MQTT_Publish(&mqtt, "gBridge/u726/d2334/onoff/set");
Adafruit_MQTT_Publish ONluminosita = Adafruit_MQTT_Publish(&mqtt, "gBridge/u726/d2334/brightness");   
Adafruit_MQTT_Publish ONonoff = Adafruit_MQTT_Publish(&mqtt, "gBridge/u726/d2334/onoff");

void setup() {
 M5.begin();
 pinMode(M5_BUTTON_HOME, INPUT);
  Serial.begin(115200);
 
  WiFi.begin(ssid, password);
 
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.println("Connecting to WiFi..");
  }
 
  Serial.println("Connected to the WiFi network");

}
 
void loop() {
  
  
  int8_t ret;


  if (mqtt.connected()) {
  
    return;
  }

  Serial.print("Connecting to MQTT... ");


  while ((ret = mqtt.connect()) != 0) { // connect will return 0 for connected
    Serial.println(mqtt.connectErrorString(ret));
    Serial.println("Retrying MQTT connection in 5 seconds...");
    mqtt.disconnect();
    delay(5000);  // wait 5 seconds

  }

  Serial.println("MQTT Connected!");
digitalRead(M5_BUTTON_HOME);
 //delay(1000);


while(digitalRead(M5_BUTTON_HOME) == LOW){
    ONonoff.publish("on");
   Serial.println("botton HI"); 
   }
//delay(500);
}
